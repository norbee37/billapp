# Data Models

## Core TypeScript Interfaces

### StockItem
**Location**: `app/types/index.ts`

Represents an item in the user's inventory.

```typescript
interface StockItem {
  id: string                    // UUID generated by server
  nameEn: string                // English name (used as grouping key)
  nameDe: string                // German translation
  nameHu: string                // Hungarian translation
  quantity: number              // Amount (can be decimal)
  unit?: string                 // 'kg', 'g', 'L', 'ml', 'pcs', 'loaf', etc.
  price?: number                // Price in EUR
  category?: string             // Food category (see Categories section)
  wasteCategories?: string[]    // Array of waste types (see Waste Categories)
  purchaseDate: Date            // Date from the receipt/bill
  createdAt: Date               // When item was added to system
  expiresAt?: Date              // Optional expiration date
}
```

**Notes**:
- `nameEn` is the canonical identifier - used for grouping
- Multiple entries can exist for the same product (different receipts)
- `wasteCategories` changed from `wasteCategory` (string) to array for multi-material packaging
- `unit` is freeform but typically standardized by LLM
- `purchaseDate` is extracted from receipt, `createdAt` is system timestamp

### ParsedItem
**Location**: `app/types/index.ts`

Represents an item parsed from a receipt (before adding to stock).

```typescript
interface ParsedItem {
  nameEn: string                // English name
  nameDe: string                // German translation
  nameHu: string                // Hungarian translation
  quantity: number              // Amount
  unit?: string                 // Unit of measurement
  price?: number                // Price in EUR
  category?: string             // Food category
  wasteCategories?: string[]    // Array of waste types
  purchaseDate?: Date           // Date from receipt (optional)
}
```

**Notes**:
- No `id` - assigned when added to stock
- No `createdAt` - assigned when added to stock
- `purchaseDate` extracted from receipt by AI
- Structure matches StockItem for easy conversion
- Returned by receipt parsing API

### Receipt
**Location**: `app/types/index.ts`

Represents a scanned receipt (currently minimal use).

```typescript
interface Receipt {
  id: string                    // UUID
  storeName?: string            // Store name from receipt
  date: Date                    // Receipt date
  items: ParsedItem[]           // Parsed items
  total?: number                // Total amount
  uploadedAt: Date              // When receipt was uploaded
}
```

**Notes**:
- Not fully implemented yet
- Receipts not persisted currently
- Could be used for receipt history feature

## Enumerations & Constants

### Product Categories

**Location**: `server/api/receipts/parse.ts`

```typescript
const CATEGORIES = [
  'Vegetables',      // Tomatoes, carrots, lettuce, etc.
  'Fruits',          // Apples, bananas, oranges, etc.
  'Meat',            // Chicken, beef, pork, etc.
  'Fish & Seafood',  // Salmon, tuna, shrimp, etc.
  'Dairy',           // Milk, cheese, yogurt, etc.
  'Bakery',          // Bread, rolls, pastries, etc.
  'Beverages',       // Juice, soda, water, coffee, etc.
  'Pantry',          // Pasta, rice, flour, oil, etc.
  'Snacks',          // Chips, cookies, chocolate, etc.
  'Frozen',          // Frozen foods
  'Other'            // Default fallback
]
```

**Logic**: 
- Keyword-based categorization
- Priority order matters (Frozen checked before Vegetables)
- English keywords only (LLM translates first)

### Waste Categories

**Location**: `server/api/receipts/parse.ts`, `app/pages/index.vue`

```typescript
const WASTE_CATEGORIES = [
  'Plastic',    // Bottles, bags, wrap, trays, containers
  'Glass',      // Glass bottles, jars
  'Paper',      // Cardboard, paper bags, cartons
  'Metal',      // Cans, aluminum foil, metal lids
  'Organic',    // Loose/unpackaged fresh produce
  'Mixed'       // Tetra Pak, composite materials
]
```

**Color Scheme** (UI):
```typescript
{
  'Plastic': 'bg-red-100 text-red-700 border-red-200',
  'Glass': 'bg-cyan-100 text-cyan-700 border-cyan-200',
  'Paper': 'bg-amber-100 text-amber-700 border-amber-200',
  'Metal': 'bg-slate-100 text-slate-700 border-slate-200',
  'Organic': 'bg-green-100 text-green-700 border-green-200',
  'Mixed': 'bg-purple-100 text-purple-700 border-purple-200'
}
```

**Icons**:
```typescript
{
  'Plastic': 'i-heroicons-beaker',
  'Glass': 'i-heroicons-square-3-stack-3d',
  'Paper': 'i-heroicons-document',
  'Metal': 'i-heroicons-cube',
  'Organic': 'i-heroicons-sparkles',
  'Mixed': 'i-heroicons-rectangle-stack'
}
```

### Language Options

**Location**: `app/composables/useLanguage.ts`, UI components

```typescript
type Language = 'en' | 'de' | 'hu'

const LANGUAGES = {
  en: { name: 'English', flag: 'ðŸ‡¬ðŸ‡§' },
  de: { name: 'Deutsch', flag: 'ðŸ‡©ðŸ‡ª' },
  hu: { name: 'Magyar', flag: 'ðŸ‡­ðŸ‡º' }
}
```

## API Request/Response Types

### Parse Receipt Request

```typescript
// POST /api/receipts/parse
// Content-Type: multipart/form-data

FormData {
  file: File  // Image file (JPEG, PNG, HEIC)
}

// Query params:
{
  provider?: 'gemini' | 'chatgpt' | 'dummy'  // Default: 'gemini'
}
```

### Parse Receipt Response

```typescript
{
  items: ParsedItem[],
  message: string  // "Receipt parsed successfully using gemini"
}
```

### Add to Stock Request

```typescript
// POST /api/stock

{
  items: ParsedItem[]  // Items to add to stock
}
```

### Add to Stock Response

```typescript
StockItem[]  // Newly created items with IDs and dates
```

### Get Stock Request/Response

```typescript
// GET /api/stock

// Response:
StockItem[]  // All stock items
```

### Delete Stock Item Request

```typescript
// DELETE /api/stock/:id

// No body
// Response: 204 No Content
```

## Computed/Derived Types

### Grouped Stock Item

**Location**: `app/pages/index.vue`

Frontend groups stock items for display:

```typescript
type GroupedStockItem = StockItem & {
  ids: string[]           // Array of IDs for all entries
  totalQuantity: number   // Sum of all quantities
  displayName: string     // Translated name based on language
}
```

**Grouping Key**: `${nameEn.toLowerCase()}_${unit}`

**Merging Logic**:
- Quantities summed
- Categories merged (unique values)
- Waste categories merged (unique values)
- IDs collected in array

## Type Utilities

### Translation Helper

```typescript
function getItemName(item: StockItem, language: Language): string {
  switch (language) {
    case 'en': return item.nameEn
    case 'de': return item.nameDe
    case 'hu': return item.nameHu
    default: return item.nameEn
  }
}
```

## Data Validation

### Current State
- **No formal validation** (trust LLM output)
- Basic type checking via TypeScript
- Default values applied when missing

### Validation Rules (Implicit)
- `quantity` must be > 0
- `price` should be >= 0 if present
- `nameEn`, `nameDe`, `nameHu` should be non-empty
- `unit` standardized by LLM
- `wasteCategories` must be array (even if single item)

## Storage Details

### In-Memory Storage

**Location**: `server/api/stock/index.ts`

```typescript
export const stockItems: StockItem[] = []
```

**Characteristics**:
- Simple array
- No persistence
- Lost on server restart
- Single user assumed
- No indexing

**Future**: Replace with database (SQLite, PostgreSQL, etc.)

## Common Transformations

### ParsedItem â†’ StockItem

```typescript
const stockItem: StockItem = {
  id: crypto.randomUUID(),
  ...parsedItem,
  purchaseDate: parsedItem.purchaseDate || new Date(),
  createdAt: new Date(),
  expiresAt: undefined  // Or calculated based on category
}
```

### Backend wasteCategory migration

For backward compatibility:

```typescript
wasteCategories: item.wasteCategories || 
                 (item.wasteCategory ? [item.wasteCategory] : undefined)
```

### Frontend quantity display

```typescript
// Convert grams to kg for display
if (unit === 'g') {
  displayQuantity = quantity / 1000
  displayUnit = 'kg'
}
```
